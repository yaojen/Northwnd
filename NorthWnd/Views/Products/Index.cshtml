
@{
    ViewBag.Title = "Index";
}

<h2>Productlist</h2>

<div class="row">
    <div class="col-lg-6">
        <!-- Button trigger modal -->
        <button type="button" class="btn btn-primary btn-default" data-toggle="modal" data-target="#myCreateModal">
            新增
        </button>

    </div>
    <div class="col-lg-6">
        <form class="form-inline">
            <div class="form-group">
                <label for="exampleInputName2">ProductName</label>
                <input type="text" class="form-control" id="SearchProductName">
            </div>
            <button type="submit" class="btn btn-default" id="btnSearch">Send invitation</button>
        </form>
    </div>
</div>

<div class="row">
    <table class="table table-striped table-hover" id="myTable" style="width: 100%">
        <thead>
            <tr>
                <td>ProductID</td>
                <td>ProductName</td>
                <td>SupplierID</td>
                <td>CategoryID</td>
                <td>UnitPrice</td>
                <td>刪除</td>
            </tr>
        </thead>
        <tbody id="mybody"></tbody>
    </table>
</div>

<!--Create Modal-->
<div class="modal fade" id="myCreateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Customer Create</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="myCreateForm">
                    <div class="form-group">
                        <label class="col-lg-2 control-label">ProductID</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="ProductID">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">ProductName</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="ProductName">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">SupplierID</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="SupplierID">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">CategoryID</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="CategoryID">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">QuantityPerUnit</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="QuantityPerUnit">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">UnitPrice</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="UnitPrice">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">UnitsInStock</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="UnitsInStock">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">UnitsOnOrder</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="UnitsOnOrder">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">ReorderLevel</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="ReorderLevel">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">Discontinued</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="Discontinued">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btnCreate" onclick="Create()">Create</button>
            </div>
        </div>
    </div>
</div>

<!--modify Modal-->
<div class="modal fade" id="myModifyModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Modify Customer</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="myModifyForm">
                    <div class="form-group">
                        <label class="col-lg-2 control-label">ProductID</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="ProductID" id="ProductID">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">ProductName</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="ProductName" id="ProductName">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">SupplierID</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="SupplierID" id="SupplierID">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">CategoryID</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="CategoryID" id="CategoryID">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">QuantityPerUnit</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="QuantityPerUnit" id="QuantityPerUnit">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">UnitPrice</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="UnitPrice" id="UnitPrice">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">UnitsInStock</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="UnitsInStock" id="UnitsInStock">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">UnitsOnOrder</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="UnitsOnOrder" id="UnitsOnOrder">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">ReorderLevel</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="ReorderLevel" id="ReorderLevel">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label">Discontinued</label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" name="Discontinued" id="Discontinued">
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="Modify()">Save changes</button>
            </div>
        </div>
    </div>
</div>


@section scripts
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.min.js"></script>
    <script src="~/Scripts/Utility.js"></script>

    <script>
        $(function() {
            $("#myTable").DataTable({
                searching: false,
                ordering: false,
                "processing": true,
                "serverSide": true,
                "pagingType": "full_numbers",

                columns: [
                    {
                        data: "ProductID",
                        className: "text-center",
                        render: function(data, type, row) {
                            return '<a href="#" onclick="GetInfo(' + row.ProductID + ')">' + row.ProductID + '</a>';
                        }
                    },
                    { data: "ProductName" },
                    { data: "SupplierID" },
                    { data: "CategoryID" },
                    { data: "UnitPrice" },
                    {
                        data: "ProductID",
                        width: "100px",
                        className: "text-center",
                        render: function(data, type, row) {
                            return '<a href="#" onclick="DelConfirm(' +
                                row.ProductID +
                                ')"><i class="glyphicon glyphicon-trash"></i></a>';
                        }
                    }
                ],
                "ajax": function(data, callback, settings) {
                    ajaxSend(null,
                        '@Url.Action("GetProductList")',
                        {
                            pageSize: data.length,
                            pageIndex: (data.start / data.length) + 1,
                            ProductName: $("#SearchProductName").val()
                        },
                        null,
                        null,
                        function(result) {
                            var resultData = {};
                            resultData.recordsTotal = result.Data.recordsTotal;
                            resultData.recordsFiltered = result.Data.recordsTotal;
                            resultData.data = result.Data.data;
                            callback(resultData);
                        });
                }
            });
        });

        var GetInfo = function(productID) {

            var action = '@Url.Action("GetProductInfo")';
            var data = { id: productID };
            var success = function(result) {
                if (result.Succ) {
                    var data = result.Data;
                    $("#ProductID").val(data.ProductID);
                    $("#ProductName").val(data.ProductName);
                    $("#SupplierID").val(data.SupplierID);
                    $("#CategoryID").val(data.CategoryID);
                    $("#QuantityPerUnit").val(data.QuantityPerUnit);
                    $("#UnitPrice").val(data.UnitPrice);
                    $("#UnitsInStock").val(data.UnitsInStock);
                    $("#UnitsOnOrder").val(data.UnitsOnOrder);
                    $("#ReorderLevel").val(data.ReorderLevel);
                    $("#Discontinued").val(data.Discontinued);


                    $("#myModifyModal").modal('show');
                }

            };
            ajaxSend(null, action, data, null, null, success, null, null);
        }

        var DelConfirm = function(productID) {

            var url = '@Url.Action("Remove")';
            var data = { id: productID };
            var success = function(result) {
                if (result.Succ) {
                    alert("刪除成功");
                    reload();
                } else {
                    alert(result.Message);
                }
            }

            ajaxSend(null, url, data, null, null, success, null, null);
        }

        var Modify = function() {
            var formData = $("#myModifyForm").serialize();
            var url = '@Url.Action("Modify")';
            var success = function(result) {
                if (result.Succ) {
                    alert("修改成功");
                    //$.unblockUI();
                    $("#myModifyModal").modal('hide');
                    modifyFormClear();
                    $("#myTable").DataTable().ajax.reload(null, false);
                } else {
                    alert(result.Message);
                }
            };
            ajaxSend(null, url, formData, null, null, success, null, null);
        };

        var Create = function() {
            var url = '@Url.Action("Create")';
            var formData = $("#myCreateForm").serialize();
            var beforeSend = function() {
                $.blockUI({
                    baseZ: 2000 });
                $("#btnCreate").attr("disabled", "disabled");
            }
         
            var success = function(result) {
                if (result.Succ) {
                    alert("新增成功");
                    $("#myCreateModal").modal('hide');
                    createFormClear();
                    $("#btnCreate").removeAttr("disabled");
                    $.unblockUI();
                    $("#myTable").DataTable().ajax.reload(null, false);
                } else {
                    alert(result.Message);
                }
            };


            ajaxSend(null, url, formData, null, beforeSend, success, null, null);
        };


        var createFormClear = function() {
            $("#myCreateForm input").each(function(key, item) {
                $(item).val("");
            });
        }

        var modifyFormClear = function() {
            $("#ProductID").val('');
            $("#ProductName").val('');
            $("#SupplierID").val('');
            $("#CategoryID").val('');
            $("#QuantityPerUnit").val('');
            $("#UnitPrice").val('');
            $("#UnitsInStock").val('');
            $("#UnitsOnOrder").val('');
            $("#ReorderLevel").val('');
            $("#Discontinued").val('');
        }


        $("#btnSearch").on("click",
            function(e) {
                e.preventDefault();
                $("#myTable").DataTable().ajax.reload(null, false);
            });
    </script>

}
